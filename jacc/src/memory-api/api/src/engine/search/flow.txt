┌───────────────────────────────────────────────────────────────────────────────────────┐
│                                    SEARCH PIPELINE                                     │
│                                                                                        │
│  ┌──────────────────────────────────────────────────────────────────────────────────┐ │
│  │                              INPUT: User Query                                    │ │
│  │                    "What did John do in Paris last summer?"                       │ │
│  └──────────────────────────────────────────────────────────────────────────────────┘ │
│                                         │                                              │
│                                         ▼                                              │
│  ┌──────────────────────────────────────────────────────────────────────────────────┐ │
│  │                         retrieve_parallel()                                       │ │
│  │                    (Main Entry Point - retrieval.py)                              │ │
│  └──────────────────────────────────────────────────────────────────────────────────┘ │
│                                         │                                              │
│              ┌──────────────────────────┼──────────────────────────┐                  │
│              ▼                          ▼                          ▼                  │
│  ┌────────────────────┐    ┌────────────────────┐    ┌────────────────────┐          │
│  │  Temporal Analysis │    │  4-Way Parallel    │    │  Graph Retriever   │          │
│  │  (temporal_ext.py) │ →  │  Retrieval         │    │  Selection         │          │
│  │                    │    │                    │    │  (MPFP vs BFS)     │          │
│  └────────────────────┘    └────────────────────┘    └────────────────────┘          │
│                                         │                                              │
│         ┌───────────────┬───────────────┼───────────────┬───────────────┐             │
│         ▼               ▼               ▼               ▼               │             │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐       │             │
│  │  SEMANTIC   │ │    BM25     │ │ GRAPH/MPFP  │ │  TEMPORAL   │       │             │
│  │  Retrieval  │ │  Retrieval  │ │  Retrieval  │ | Retrieval   │       │             │
│  │             │ │             │ │             │ │ (optional)  │       │             │
│  │ Vector Sim  │ │ Full-Text   │ │ BFS / MPFP  │ │ Date Range  │       │             │
│  └─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘       │             │
│         │               │               │               │               │             │
│         └───────────────┴───────────────┴───────────────┘               │             │
│                                         │                               │             │
│                                         ▼                               │             │
│  ┌──────────────────────────────────────────────────────────────────────┐             │
│  │                    ParallelRetrievalResult                           │             │
│  │                                                                       │             │
│  │  • semantic: list[RetrievalResult]                                   │             │
│  │  • bm25: list[RetrievalResult]                                       │             │
│  │  • graph: list[RetrievalResult]                                      │             │
│  │  • temporal: list[RetrievalResult] | None                            │             │
│  │  • timings: dict[str, float]                                         │             │
│  └──────────────────────────────────────────────────────────────────────┘             │
│                                         │                                              │
│                                         ▼                                              │
│  ┌──────────────────────────────────────────────────────────────────────┐             │
│  │                    reciprocal_rank_fusion() to get final candidates   │             │
│  │                         (fusion.py)                                   │             │
│  │                                                                       │             │
│  │  Merge 3-4 ranked lists using RRF formula:                           │             │
│  │  score(d) = Σ 1/(k + rank(d))  over all lists                        │             │
│  └──────────────────────────────────────────────────────────────────────┘             │
│                                         │                                              │
│                                         ▼                                              │
│  ┌──────────────────────────────────────────────────────────────────────┐             │
│  │                        list[MergedCandidate]                         │             │
│  │                                                                       │             │
│  │  • retrieval: RetrievalResult (original data)                        │             │
│  │  • rrf_score: float                                                  │             │
│  │  • source_ranks: {semantic_rank: 3, bm25_rank: 1, ...}               │             │
│  └──────────────────────────────────────────────────────────────────────┘             │
│                                         │                                              │
│                                         ▼                                              │
│  ┌──────────────────────────────────────────────────────────────────────┐             │
│  │                 CrossEncoderReranker.rerank()                        │             │
│  │                        (reranking.py)                                 │             │
│  │                                                                       │             │
│  │  Neural scoring: [query, document_text] → relevance score            │             │
│  └──────────────────────────────────────────────────────────────────────┘             │
│                                         │                                              │
│                                         ▼                                              │
│  ┌──────────────────────────────────────────────────────────────────────┐             │
│  │                         list[ScoredResult]                           │             │
│  │                                                                       │             │
│  │  • candidate: MergedCandidate                                        │             │
│  │  • cross_encoder_score: float                                        │             │
│  │  • recency, temporal, combined_score, weight                         │             │
│  └──────────────────────────────────────────────────────────────────────┘             │
│                                         │                                              │
│                                         ▼                                              │
│  ┌──────────────────────────────────────────────────────────────────────┐             │
│  │                            OUTPUT                                     │             │
│  │                  Top-K ranked memory facts                            │             │
│  └──────────────────────────────────────────────────────────────────────┘             │
└───────────────────────────────────────────────────────────────────────────────────────┘